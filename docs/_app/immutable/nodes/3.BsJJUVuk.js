import{a as b,f as w}from"../chunks/Ct8hVUib.js";import{i as E}from"../chunks/B-aGsofq.js";import{G as o,H as r,I as f,E as C,w as n,a9 as G,aa as H,C as I,g as _,x as M,F as K,ab as X,V as L,W,ac as B}from"../chunks/DJ6dxAbS.js";import{s as p,e as Y}from"../chunks/CdfOKeRi.js";import{p as Q,i as D}from"../chunks/D1HYs85v.js";import{e as V,s as Z,i as z,q as ee}from"../chunks/C6BFq5hD.js";var te=w('<div class="flex items-center gap-3"><div class="w-40 text-sm truncate"> </div> <div class="flex-1 bg-slate-200/60 rounded h-2"><div class="bg-slate-700 h-2 rounded transition-all"></div></div> <div class="w-8 text-sm text-right"> </div></div>'),se=w('<div class="space-y-2 max-w-xl"></div>');function ae(O,k){let T=Q(k,"values",8);const s=Object.entries(T()),v=Math.max(...s.map(([,c])=>c),1);var x=se();V(x,5,()=>s,z,(c,q)=>{var F=G(()=>H(n(q),2));let S=()=>n(F)[0],N=()=>n(F)[1];var $=te(),g=o($),j=o(g,!0);r(g);var h=f(g,2),R=o(h);r(h);var J=f(h,2),l=o(J,!0);r(J),r($),C(()=>{p(j,S()),Z(R,`width: ${N()/v*100}%`),p(l,N())}),b(c,$)}),r(x),b(O,x)}var re=w('<p class="text-sm">Average score: <strong> </strong> </p>'),ie=w("<li> </li>"),oe=w('<details class="mt-2"><summary class="cursor-pointer text-sm"> </summary> <ul class="mt-1 text-sm text-slate-700"></ul></details>'),le=w('<div class="rounded-xl border bg-white p-5 shadow-sm space-y-3"><h3 class="font-medium"> </h3> <p class="text-sm text-slate-500"> </p> <!> <!> <!></div>');function ne(O,k){I(k,!1);let T=Q(k,"qid",8),s=Q(k,"data",8);s().keywords&&Object.entries(s().keywords).sort((l,m)=>m[1]-l[1]).slice(0,5);const v=s().question,x=v.type==="rating"&&s().count>0?(s().sum/s().count).toFixed(2):null;E();var c=le(),q=o(c),F=o(q);r(q);var S=f(q,2),N=o(S);r(S);var $=f(S,2);{var g=l=>{var m=re(),y=f(o(m)),P=o(y,!0);r(y);var a=f(y);r(m),C(()=>{p(P,x),p(a,` / ${_(()=>v.max)??""}`)}),b(l,m)};D($,l=>{_(()=>v.type==="rating")&&l(g)})}var j=f($,2);{var h=l=>{ae(l,{get values(){return M(s()),_(()=>s().values)}})};D(j,l=>{_(()=>v.type==="single"||v.type==="multi")&&l(h)})}var R=f(j,2);{var J=l=>{var m=oe(),y=o(m),P=o(y);r(y);var a=f(y,2);V(a,5,()=>(M(s()),_(()=>s().freeText)),z,(t,d)=>{var e=ie(),i=o(e);r(e),C(()=>p(i,`â€¢ ${n(d)??""}`)),b(t,e)}),r(a),r(m),C(()=>p(P,`Verbatim responses (${M(s()),_(()=>s().freeText.length)??""})`)),b(l,m)};D(R,l=>{M(s()),_(()=>s().freeText.length)&&l(J)})}r(c),C(()=>{p(F,`${T()??""}. ${_(()=>v.prompt)??""}`),p(N,`Responses: ${M(s()),_(()=>s().count)??""}`)}),b(O,c),K()}var ve=w('<div class="text-sm text-slate-700 space-y-1"><div><strong> </strong> </div> <div class="text-xs text-slate-500"> </div></div>'),de=w('<div class="space-y-6"></div>'),fe=w(`<section class="bg-slate-50 min-h-screen py-10"><div class="mx-auto max-w-5xl px-6 space-y-8"><header class="space-y-2"><h2 class="text-2xl font-semibold tracking-tight text-slate-900">Questionnaire analysis</h2> <p class="text-sm text-slate-600 max-w-2xl">Aggregated results from submitted questionnaire response files.
				Data is analysed per question and shown in summary form.</p></header> <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm space-y-4"><div class="flex flex-col gap-2"><label class="text-sm font-medium text-slate-700">Response files</label> <input type="file" multiple webkitdirectory accept=".json" class="block w-full text-sm text-slate-700
						file:mr-4 file:rounded-lg file:border-0
						file:bg-slate-900 file:px-4 file:py-2
						file:text-sm file:font-medium file:text-white
						hover:file:bg-slate-800"/> <p class="text-xs text-slate-500">Select the folder containing downloaded questionnaire response JSON files. Other files (for example system or hidden files) will be ignored automatically.</p></div> <!></div> <!></div></section>`);function ce(O,k){I(k,!1);let T=L(0),s=L(0),v=L(0),x=[],c=L({});const q=new Map;for(const a of ee.sections)for(const t of a.questions)q.set(t.id,t);async function F(a){const t=a.currentTarget;if(!t.files||t.files.length===0)return;if(x=[],W(c,{}),W(T,t.files.length),W(s,0),W(v,0),!Array.from(t.files).some(e=>e.webkitRelativePath&&e.webkitRelativePath.includes("/"))){alert("Please select a folder containing the response files.");return}for(const e of Array.from(t.files))if(e.name.toLowerCase().endsWith(".json")){B(s);try{const i=JSON.parse(await e.text());x.push(i),B(v)}catch{console.warn("Skipping invalid JSON:",e.name)}}if(n(v)===0){alert("No valid questionnaire JSON files were found in this folder.");return}$()}const S=new Set(["the","and","to","of","a","in","for","is","on","that","with","as","are","it","be","or","by","this","an","at","from","if","but","we","they","their","our"]);function N(a){const t={};for(const d of a){const e=d.toLowerCase().replace(/[^a-z0-9\s]/g,"").split(/\s+/).filter(i=>i.length>2&&!S.has(i));for(const i of e)t[i]=(t[i]||0)+1}return t}function $(){const a={};for(const t of x)for(const[d,e]of Object.entries(t.answers)){const i=q.get(d);if(!i)continue;a[d]||(a[d]={question:i,count:0,values:{},sum:0,freeText:[],keywords:{}});const u=a[d];if(u.count++,i.type==="rating"&&typeof e.value=="number"&&(u.sum+=e.value),i.type==="single"&&(u.values[e.value]=(u.values[e.value]||0)+1),i.type==="multi"&&Array.isArray(e.value))for(const A of e.value)u.values[A]=(u.values[A]||0)+1;i.type==="text"&&typeof e.value=="string"&&e.value.trim()&&u.freeText.push(e.value.trim()),e.otherText?.trim()&&u.freeText.push(e.otherText.trim())}for(const t of Object.values(a))t.freeText.length>0&&(t.keywords=N(t.freeText));W(c,a)}E();var g=fe(),j=o(g),h=f(o(j),2),R=o(h),J=f(o(R),2);X(2),r(R);var l=f(R,2);{var m=a=>{var t=ve(),d=o(t),e=o(d),i=o(e,!0);r(e);var u=f(e);r(d);var A=f(d,2),U=o(A);r(A),r(t),C(()=>{p(i,n(v)),p(u,` valid response file${n(v)===1?"":"s"} processed`),p(U,`(${n(s)??""} JSON file${n(s)===1?"":"s"} found in ${n(T)??""} total file${n(T)===1?"":"s"})`)}),b(a,t)};D(l,a=>{n(v)>0&&a(m)})}r(h);var y=f(h,2);{var P=a=>{var t=de();V(t,5,()=>Object.entries(n(c)),z,(d,e)=>{var i=G(()=>H(n(e),2));let u=()=>n(i)[0],A=()=>n(i)[1];ne(d,{get qid(){return u()},get data(){return A()}})}),r(t),b(a,t)};D(y,a=>{Object.keys(n(c)).length>0&&a(P)})}r(j),r(g),Y("change",J,F),b(O,g),K()}function ye(O){ce(O,{})}export{ye as component};
