import{a as w,f as $}from"../chunks/Ct8hVUib.js";import{i as H}from"../chunks/B-aGsofq.js";import{G as n,H as i,I as v,E as N,w as c,a9 as K,aa as U,C as X,g as _,x as J,F as Y,V as L,W as A,ab as ae,ac as G}from"../chunks/DJ6dxAbS.js";import{s as p,e as Z}from"../chunks/CdfOKeRi.js";import{p as V,i as P}from"../chunks/D1HYs85v.js";import{e as z,s as re,i as B,q as ie}from"../chunks/C6BFq5hD.js";var oe=$('<div class="flex items-center gap-3"><div class="w-40 text-sm truncate"> </div> <div class="flex-1 bg-slate-200/60 rounded h-2"><div class="bg-slate-700 h-2 rounded transition-all"></div></div> <div class="w-8 text-sm text-right"> </div></div>'),ne=$('<div class="space-y-2 max-w-xl"></div>');function le(k,O){let q=V(O,"values",8);const a=Object.entries(q()),u=Math.max(...a.map(([,x])=>x),1);var g=ne();z(g,5,()=>a,B,(x,j)=>{var d=K(()=>U(c(j),2));let R=()=>c(d)[0],C=()=>c(d)[1];var h=oe(),m=n(h),T=n(m,!0);i(m);var y=v(m,2),b=n(y);i(y);var F=v(y,2),S=n(F,!0);i(F),i(h),N(()=>{p(T,R()),re(b,`width: ${C()/u*100}%`),p(S,C())}),w(x,h)}),i(g),w(k,g)}var de=$('<p class="text-sm">Average score: <strong> </strong> </p>'),ce=$("<li> </li>"),ve=$('<details class="mt-2"><summary class="cursor-pointer text-sm"> </summary> <ul class="mt-1 text-sm text-slate-700"></ul></details>'),fe=$('<div class="rounded-xl border bg-white p-5 shadow-sm space-y-3"><div class="flex items-start justify-between gap-4"><h3 class="font-medium"> </h3> <button type="button" class="shrink-0 text-xs rounded-md border px-2 py-1 text-slate-600 hover:bg-slate-100" title="Copy a Markdown summary suitable for pasting into an LLM or document"> </button></div> <p class="text-sm text-slate-500"> </p> <!> <!> <!></div>');function ue(k,O){X(O,!1);let q=V(O,"qid",8),a=V(O,"data",8),u=L(!1);function g(){let e=`### ${q()} — ${d.prompt}
`;if(e+=`Responses: ${a().count}

`,d.type==="rating"&&R!==null&&(e+=`**Average rating:** ${R} / ${d.max}

`),(d.type==="single"||d.type==="multi")&&a().values){e+=`**Response distribution:**
`;for(const[r,l]of Object.entries(a().values)){const M=C[r]??r;e+=`- ${M}: ${l}
`}e+=`
`}if(j.length){e+=`**Top themes:**
`;for(const[r,l]of j)e+=`- ${r} (${l})
`;e+=`
`}if(a().freeText?.length){e+=`**Representative responses:**
`;for(const r of a().freeText.slice(0,5))e+=`- “${r}”
`}return e}async function x(){try{await navigator.clipboard.writeText(g()),A(u,!0),setTimeout(()=>A(u,!1),1500)}catch{alert("Unable to copy to clipboard")}}const j=[],d=a().question,R=d.type==="rating"&&a().count>0?(a().sum/a().count).toFixed(2):null,C=d.options?Object.fromEntries(d.options.map(e=>[e.id,e.label])):{};H();var h=fe(),m=n(h),T=n(m),y=n(T);i(T);var b=v(T,2),F=n(b,!0);i(b),i(m);var S=v(m,2),E=n(S);i(S);var W=v(S,2);{var I=e=>{var r=de(),l=v(n(r)),M=n(l,!0);i(l);var D=v(l);i(r),N(()=>{p(M,R),p(D,` / ${_(()=>d.max)??""}`)}),w(e,r)};P(W,e=>{_(()=>d.type==="rating")&&e(I)})}var o=v(W,2);{var t=e=>{le(e,{get values(){return J(a()),_(()=>a().values)}})};P(o,e=>{_(()=>d.type==="single"||d.type==="multi")&&e(t)})}var f=v(o,2);{var s=e=>{var r=ve(),l=n(r),M=n(l);i(l);var D=v(l,2);z(D,5,()=>(J(a()),_(()=>a().freeText)),B,(ee,te)=>{var Q=ce(),se=n(Q);i(Q),N(()=>p(se,`• ${c(te)??""}`)),w(ee,Q)}),i(D),i(r),N(()=>p(M,`Verbatim responses (${J(a()),_(()=>a().freeText.length)??""})`)),w(e,r)};P(f,e=>{J(a()),_(()=>a().freeText.length)&&e(s)})}i(h),N(()=>{p(y,`${q()??""}. ${_(()=>d.prompt)??""}`),p(F,c(u)?"Copied ✓":"Copy Markdown"),p(E,`Responses: ${J(a()),_(()=>a().count)??""}`)}),Z("click",b,x),w(k,h),Y()}var pe=$('<div class="text-sm text-slate-700 space-y-1"><div><strong> </strong> </div> <div class="text-xs text-slate-500"> </div></div>'),me=$('<div class="space-y-6"></div>'),xe=$(`<section class="bg-slate-50 min-h-screen py-10"><div class="mx-auto max-w-5xl px-6 space-y-8"><header class="space-y-2"><h2 class="text-2xl font-semibold tracking-tight text-slate-900">Questionnaire analysis</h2> <p class="text-sm text-slate-600 max-w-2xl">Aggregated results from submitted questionnaire response files.
				Data is analysed per question and shown in summary form.</p></header> <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm space-y-4"><div class="flex flex-col gap-2"><label class="text-sm font-medium text-slate-700">Response files</label> <input type="file" multiple webkitdirectory accept=".json" class="block w-full text-sm text-slate-700
						file:mr-4 file:rounded-lg file:border-0
						file:bg-slate-900 file:px-4 file:py-2
						file:text-sm file:font-medium file:text-white
						hover:file:bg-slate-800"/> <p class="text-xs text-slate-500">Select the folder containing downloaded questionnaire response JSON files. Other files (for example system or hidden files) will be ignored automatically.</p></div> <!></div> <!></div></section>`);function ge(k,O){X(O,!1);let q=L(0),a=L(0),u=L(0),g=[],x=L({});const j=new Map;for(const o of ie.sections)for(const t of o.questions)j.set(t.id,t);async function d(o){const t=o.currentTarget;if(!t.files||t.files.length===0)return;if(g=[],A(x,{}),A(q,t.files.length),A(a,0),A(u,0),!Array.from(t.files).some(s=>s.webkitRelativePath&&s.webkitRelativePath.includes("/"))){alert("Please select a folder containing the response files.");return}for(const s of Array.from(t.files))if(s.name.toLowerCase().endsWith(".json")){G(a);try{const e=JSON.parse(await s.text());g.push(e),G(u)}catch{console.warn("Skipping invalid JSON:",s.name)}}if(c(u)===0){alert("No valid questionnaire JSON files were found in this folder.");return}h()}const R=new Set(["the","and","to","of","a","in","for","is","on","that","with","as","are","it","be","or","by","this","an","at","from","if","but","we","they","their","our"]);function C(o){const t={};for(const f of o){const s=f.toLowerCase().replace(/[^a-z0-9\s]/g,"").split(/\s+/).filter(e=>e.length>2&&!R.has(e));for(const e of s)t[e]=(t[e]||0)+1}return t}function h(){const o={};for(const t of g)for(const[f,s]of Object.entries(t.answers)){const e=j.get(f);if(!e)continue;o[f]||(o[f]={question:e,count:0,values:{},sum:0,freeText:[],keywords:{}});const r=o[f];if(r.count++,e.type==="rating"&&typeof s.value=="number"&&(r.sum+=s.value),e.type==="single"&&(r.values[s.value]=(r.values[s.value]||0)+1),e.type==="multi"&&Array.isArray(s.value))for(const l of s.value)r.values[l]=(r.values[l]||0)+1;e.type==="text"&&typeof s.value=="string"&&s.value.trim()&&r.freeText.push(s.value.trim()),s.otherText?.trim()&&r.freeText.push(s.otherText.trim())}for(const t of Object.values(o))t.freeText.length>0&&(t.keywords=C(t.freeText));A(x,o)}H();var m=xe(),T=n(m),y=v(n(T),2),b=n(y),F=v(n(b),2);ae(2),i(b);var S=v(b,2);{var E=o=>{var t=pe(),f=n(t),s=n(f),e=n(s,!0);i(s);var r=v(s);i(f);var l=v(f,2),M=n(l);i(l),i(t),N(()=>{p(e,c(u)),p(r,` valid response file${c(u)===1?"":"s"} processed`),p(M,`(${c(a)??""} JSON file${c(a)===1?"":"s"} found in ${c(q)??""} total file${c(q)===1?"":"s"})`)}),w(o,t)};P(S,o=>{c(u)>0&&o(E)})}i(y);var W=v(y,2);{var I=o=>{var t=me();z(t,5,()=>Object.entries(c(x)),B,(f,s)=>{var e=K(()=>U(c(s),2));let r=()=>c(e)[0],l=()=>c(e)[1];ue(f,{get qid(){return r()},get data(){return l()}})}),i(t),w(o,t)};P(W,o=>{Object.keys(c(x)).length>0&&o(I)})}i(T),i(m),Z("change",F,d),w(k,m),Y()}function qe(k){ge(k,{})}export{qe as component};
